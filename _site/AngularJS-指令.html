<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8" />
    <title>AngularJS应用－指令 | juzipi</title>
    <meta name="renderer" content="webkit">
    <meta name="description" content="Blog" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="/blog/css/default.css" type="text/css" />
    <link rel="icon" href="/blog/logo.png" type="image/png">
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
    <script src="/blog/js/jquery-1.7.1.min.js" type="text/javascript"></script>
</head>
<body>


    <link rel="stylesheet" href="/blog/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>
<div class="head">
    <a href="http://juzipi.github.io/blog/">
        <img src="../images/logo_24.png" alt="logo" class="logo" />
    </a>
</div>
<div id="content">
    
    <div class="entry">
        <h1 class="entry-title"><a href="/blog/AngularJS-%E6%8C%87%E4%BB%A4" title="AngularJS应用－指令">AngularJS应用－指令</a></h1>
        <p class="entry-date">2014-09-23</p>
        <h2>一、基本概念</h2>

<p>说明概念：附加在HTML元素上面自定义标记，可以是：标签、属性、class类，通过AngularJS的HTML编辑器（$compile），在指定元素上面附加指定的行为，可以操作DOM，改变DOM元素，甚至它子节点。</p>

<p>一般都是用ng开始，表示指令。
部分内置指令：ngBind,ngModle,ngView,ngClick等。
指令匹配形式：</p>

<pre><code>// 推荐使用方式
&lt;span ng-bing="name"&gt;&lt;/span&gt;
&lt;span ng:bind="name"&gt;&lt;/span&gt;
&lt;span ng_bind="name"&gt;&lt;/span&gt;
// 符合HTML验证，（data）
&lt;span data-ng-bind="name"&gt;&lt;/span&gt;
&lt;span x-ng-bing="name"&gt;&lt;/span&gt;
</code></pre>

<h2>二、应用</h2>

<h3>2.1 注册指令：</h3>

<p>基本方法：</p>

<pre><code>module.directive("dir",function(){
    return {

    }
})
</code></pre>

<p>一般返回一个匿名的对象</p>

<p>替换内容</p>

<pre><code>&lt;div class="" ng-controller="de"&gt;
    &lt;hello&gt;&lt;/hello&gt;
&lt;/div&gt;

//定义了一个hello指令
var MyModule = angular.module("MyModule",[]);
MyModule.directive("hello",function(){
    return {
        restrict : "E",
        template : "&lt;div&gt;替换了&lt;/div&gt;",
        replace : true
    }
})
</code></pre>

<p>restrict 可以是四个值：</p>

<ul>
<li>E：表示元素标签，<hello></hello></li>
<li>A：表示属性(默认属性), <div hello></hello></li>
<li>M：表示注释, <!-- directive: hello --></li>
<li>C：表示样式（class）,<div class="hello" ></div></li>
</ul>


<blockquote><p>遇到一个问题，样式（C）时，使用在input输入框，不能用“－”并且在指令名称中不能用大写，如果标签中是大写，那么在注册的时候需要改成小写。
但是不能input框，可以注册用大写。没有找到规律</p></blockquote>

<h3>2.2 保留原有内容，并且增加内容：</h3>

<pre><code>MyModule.directive("hello",function(){
    return {
        restrict : "E",
        transclude : true,
        template : "&lt;div&gt;添加内容&lt;div ng-transclude&gt;&lt;/div&gt;&lt;/div&gt;"
    }
})
</code></pre>

<h3>2.3 引用html模版</h3>

<p>当有大量的html需要修改或者替换的时候可用，引用html模版文件，这样减少在js中写大量到html代码，并且还需要考虑拼接：</p>

<pre><code>MyModule.directive("hello",function(){
    return {
        restrict : "E",
        templateUrl : "hello.html",
        replace : true
    }
})
&lt;-- hello.html --&gt;
&lt;div&gt;替换内容&lt;/div&gt;
</code></pre>

<blockquote><p>这里可以考虑一些常用的html模块，直接用这种方式，给一个指令直接就把需要的html结构给出来，但是这里还牵涉到一个css，和这个模块要用到的js。参考fis</p></blockquote>

<p>缓存模版，当有一些模版会重复使用到到的时候可以使用缓存模版方式，主要是牵涉到几个方法，put、get</p>

<pre><code>//注射器加载完所有模块时，此方法执行一次，run。
MyModule.run(function($templateCache){

    //put设置缓存模版，第一参数定义名称，第二个是内容。
    $templateCache.put("h","&lt;div&gt;缓存内容&lt;/div&gt;");

})

//获取缓存的内容
MyModule.directive("hello",function(){
    return {
        restrict : "E",
        replace : true,
        template : $templateCache.get("h")
    }
})
</code></pre>

<h3>2.4 LINk方法：</h3>

<p>参数有四个分别是scope,element,attr,ctrl</p>

<pre><code>&lt;!-- 指令 link使用 --&gt;
&lt;!-- 定义controller --&gt;
&lt;div class="" ng-controller="myLoad"&gt;
    &lt;load class="btn-deep-blue mt-vbig"&gt;测试加载&lt;/load&gt;
    &lt;div id="show"&gt;显示&lt;/div&gt;
&lt;/div&gt;
</code></pre>

<p>定义contraoller里面的方法：</p>

<pre><code>var myLoadModule = angular.module("MyModule",[]);
myLoadModule.controller("myLoad",["$scope",function($scope){

    $scope.loadData = function(){
        angular.element(document.querySelector("#show")).addClass("btn-deep-blue");
        console.log("加载。。");
    }

}]);

//定义指令
    myLoadModule.directive("load",function(){
    return {
        restrict:"E",
        link : function(scope,element,attr){
                element.bind("click",function(){
//这里的scope相当于和控制器中的$scope相连接了，能够获取到控制中的方法，通过$scope中转站衔接
                    scope.loadData();
                    // 作用相同:
                    // scope.$apply("loadData()")
                })

        }
    }
})
</code></pre>

<h3>2.5 指令复用</h3>

<p>通过link中的attr属性去复用指令</p>

<p>HTML:</p>

<pre><code>&lt;div class="" ng-controller="myLoad1"&gt;
    &lt;loading class="btn-deep-blue mt-vbig" loadfn="loadData()"&gt;测试加载&lt;/loading&gt;
&lt;/div&gt;  
&lt;div class="" ng-controller="myLoad2"&gt;
    &lt;loading class="btn-deep-blue mt-vbig" loadfn="loadData2()"&gt;测试加载2&lt;/loading&gt;
&lt;/div&gt;
</code></pre>

<p>JS:</p>

<pre><code>// 控制器定义
var MyModule = angular.module("MyModule",[]);
MyModule.controller("myLoad1",["$scope",function($scope){
    $scope.loadData = function(){
        console.log("加载。。1");
    }
}]);

MyModule.controller("myLoad2",["$scope",function($scope){
    $scope.loadData2 = function(){
        console.log("加载。。2");
    }
}]);

// 指令定义
myLoadModule.directive("load",function(){
    return {
        restrict:"E",
        link : function(scope,element,attr){
                element.bind("click",function(){
                    scope.$apply(attr.loadfn)
        // 这里loadfn注意要小写
                })

        }
    }
})
</code></pre>

<h3>2.6 指令间的调用</h3>

<p>这里说一下另外一个方法：controller</p>

<p>HTML:</p>

<pre><code>&lt;ul&gt;
    &lt;superman strength&gt;力量&lt;/superman&gt;
    &lt;superman strength speed&gt;力量、速度&lt;/superman&gt;
    &lt;superman strength speed light&gt;力量、速度、光&lt;/superman&gt;
&lt;/ul&gt;
</code></pre>

<p>这里的controller是指令内部的，是暴露一些方法给外部调用:</p>

<pre><code>// 指令间调用
MyModule.directive("superman",function(){
    return {
        //独立作用域
        scope:{},
        restrict: "AE",
        controller: function($scope){
            $scope.abilities=[];
            // 这里的this指的是？这里看是调用这个controller方法的对象，通过下面的调用知道，这是指令对象
            this.addStrength=function(){
                $scope.abilities.push("strength");
            }
            this.addSpeed=function(){
                $scope.abilities.push("speed");
            }
            this.addLight=function(){
                $scope.abilities.push("light");
            }
        },
        link : function(scope,element,attr){
            element.addClass("btn-deep-blue mt-tiny");
            element.bind("click",function(){
                console.log(scope.abilities);
            })
        }
    }
});

MyModule.directive("strength",function(){
    return {
        //require 引用了一个指令对象
        require: "^superman",
        // link最后一个参数是传入 require引用的对象
        link: function(scope,element,attr,s){
            s.addStrength();
        }
    }
});
MyModule.directive("speed",function(){
    return {
        require: "^superman",
        link: function(scope,element,attr,supermanCtrl){
            supermanCtrl.addSpeed();
        }
    }
});
MyModule.directive("light",function(){
    return {
        require: "^superman",
        link: function(scope,element,attr,supermanCtrl){
            supermanCtrl.addLight();
        }
    }
});
</code></pre>

<blockquote><p>什么时候用controller什么时候用link，link指指令内部，做一个绑定事件，或者一些事件的处理，而controller是给外部调用</p></blockquote>


       
    </div>



    <div class="sidenav">
        <h2>语言</h2>
        <ul class="artical-list">
        
            <li><a href="/blog/promise">promise对象</a>
            
            </li>
        
            <li><a href="/blog/%E8%A3%85%E9%A5%B0%E6%80%A7%E6%A8%A1%E5%BC%8F">装饰性模式</a>
            
            </li>
        
            <li><a href="/blog/AngularJS%E5%AE%9E%E6%88%98-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5">AngularJS应用－基础概念</a>
            
            </li>
        
            <li><a href="/blog/AngularJS-%E6%8C%87%E4%BB%A4">AngularJS应用－指令</a>
            
            </li>
        
            <li><a href="/blog/Javascript%E6%A8%A1%E5%BC%8F%E5%AD%A6%E4%B9%A0-%E5%87%BD%E6%95%B0">学习笔记－设计模式 －函数</a>
            
            </li>
        
            <li><a href="/blog/Javascript%E6%A8%A1%E5%BC%8F%E5%AD%A6%E4%B9%A0">学习笔记－设计模式－基础</a>
            
            </li>
        
            <li><a href="/blog/%E5%AD%A6%E4%B9%A0%E6%80%9D%E8%80%83">模块化学习思考</a>
            
            </li>
        
            <li><a href="/blog/RequireJs%E4%BD%BF%E7%94%A8">RequireJs应用</a>
            
            </li>
        
            <li><a href="/blog/apply%E5%92%8Ccall">apply和call应用</a>
            
            </li>
        
            <li><a href="/blog/%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81">表单验证－策略模式</a>
            
            </li>
        
        </ul>

        <h2>工具</h2>
        <ul class="artical-list">
        
            <li><a href="/blog/webpack%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8">webpack使用方法</a></li>
        
            <li><a href="/blog/javascript%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83">前端规范的思考</a></li>
        
            <li><a href="/blog/jekyll%E4%BD%BF%E7%94%A8">jekyll基本使用方式</a></li>
        
        </ul>

        <h2>项目沉淀</h2>
        <ul class="artical-list">
        
            <li><a href="/blog/%E5%91%A8%E7%BA%AA%E5%BD%95">15年08月19日－周工作记录</a></li>
        
        </ul>
    </div>
</div>

<script src="/blog/js/post.js" type="text/javascript"></script>


    
</body>
</html>
