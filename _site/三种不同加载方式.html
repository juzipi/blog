<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8" />
    <title>async、defer、preload区别 | juzipi</title>
    <meta name="renderer" content="webkit">
    <meta name="description" content="Blog" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="./css/default.css" type="text/css" />
    <link rel="icon" href="./logo.png" type="image/png">
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
    <script src="./js/jquery-1.7.1.min.js" type="text/javascript"></script>
</head>
<body>


    <link rel="stylesheet" href="./js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>
<div class="head">
    <a href="./">
        <img src="./images/logo_24.png" alt="logo" class="logo" />
    </a>
</div>
<div id="content">
    
    <div class="entry">
        <h1 class="entry-title"><a href="./%E4%B8%89%E7%A7%8D%E4%B8%8D%E5%90%8C%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F" title="async、defer、preload区别">async、defer、preload区别</a></h1>
        <p class="entry-date">2015-01-22</p>
        <p>async、defer、preload区别</p>

<p>示例：</p>

<pre><code class="html">&lt;html&gt;
&lt;head&gt;
    &lt;link rel="stylesheet" type="text/css" href="/style.css"&gt;
    &lt;script type="text/javascript" src="/header.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;p&gt;Text&lt;/p&gt;
  &lt;script type="text/javascript" src="/main.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>这里解析过程是：</p>

<p>1、开始解析html</p>

<p>2、遇到css暂停解析，然后下载css并解析，</p>

<p>3、接着遇到js暂停html解析，然后下载js并解析</p>

<p>4、继续解析html</p>

<p>5、遇到main.js，暂停解析html，下载js并解析</p>

<p>6、完成html解析</p>

<h3>preload</h3>

<p>当设置preload时候，浏览器不会暂停html解析，但是会加载资源。</p>

<p>支持的类型包括img、js、css、font、audio、video、fetch</p>

<pre><code class="html">&lt;link rel="preload" herf="style.css" as="style"&gt;
&lt;link rel="perload" herf="main.js" as="script"&gt;
&lt;link rel="preload" href="bg-image-wide.png" as="image" media="(min-width: 601px)"&gt;
&lt;link rel="preload" href="fonts/cicle_fina-webfont.ttf" as="font" type="font/ttf" crossorigin="anonymous"&gt;
</code></pre>

<blockquote><p>这里只是把资源加载进来，并没有对文档产生影响，比如里面定义的class和变量是获取不到。</p>

<p>加载跨域的资源的需要设置：crossorigin</p></blockquote>

<p>直到真正需要使用的时候再正常引入</p>

<pre><code class="html">    &lt;link rel="stylesheet" href="style.css"&gt;
    &lt;script src="main.js"&gt;&lt;/script&gt;
</code></pre>

<h3>自由控制</h3>

<p>控制资源什么时候加载什么时候解析，通过脚本来完成：</p>

<pre><code class="javascript">var preloadLink = document.createElement("link");
preloadLink.href = "myscript.js";
preloadLink.rel = "preload";
preloadLink.as = "script";
document.head.appendChild(preloadLink);
</code></pre>

<p>这里只是预加载并不执行，当需要执行的时候可以：</p>

<pre><code class="javascript">var preloadedScript = document.createElement("script");
preloadedScript.src = "myscript.js";
document.body.appendChild(preloadedScript);
</code></pre>

<p>兼容性：
<img src="http://juzipi.github.io/blog/images/preload.png" alt="preload" /></p>

<blockquote><p>手机端目前兼容性太差</p></blockquote>

<h3>Prefetch</h3>

<p>浏览器空闲之后下载， 也就是把预加载的权限开放给浏览器来决定。
但是有一个问题，当预加载未完成的时候，后面又引用需要的资源，这个时候浏览器会两次加载。</p>

<pre><code class="html">&lt;link rel="prefetch" href="style.css" /&gt;
</code></pre>

<h3>async、defer</h3>

<p>基本上所有的大的互联网首页都有对这两个属性的应用，到底有什么用。用于在不阻塞页面文档解析的前提下，控制脚本的下载和执行，流程和解析：
<img src="http://juzipi.github.io/blog/images/%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BDjs%E6%96%B9%E6%A1%88.jpg" alt="" />
可以看到当设置defer时，先会加载然后等待HTML解析完成后在解析js。
设置async时，先加载然后加载完成后就立刻解析js，这个时候会中断html解析。等解析完成js后再继续HTML解析。</p>

<p>兼容性：
<img src="http://juzipi.github.io/blog/images/async.png" alt="" /></p>

<h3>dns-prefetch</h3>

<p>提前给域名解析，提升加载速度。</p>

<p>合理的应用dns-prefetch可以加快整个商户度50ms-300ms.</p>

<ul>
<li>浏览器会对页面中包含的link、href的域名自动dns-prefetch。（对https不起作用，需要手动开启）</li>
</ul>


<pre><code class="html">&lt;meta http-equiv="x-dns-prefetch-control" content="on" &gt;
</code></pre>

<ul>
<li>需要手动添加link标签的场景是：你预计用户在后面的访问中需要用到当前页面的所有链接都不包含的域名</li>
</ul>


<blockquote><p>查看chrome中域名预解析情况：chrome://dns/或者chrome://histograms/DNS</p></blockquote>


       
    </div>



    <div class="sidenav">
        <h2>语言</h2>
        <ul class="artical-list">
        
            <li><a href="./%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">上传图片</a>
            
            </li>
        
            <li><a href="./%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F">图片加载的几种方式</a>
            
            </li>
        
            <li><a href="./promise">promise对象</a>
            
            </li>
        
            <li><a href="./%E8%A3%85%E9%A5%B0%E6%80%A7%E6%A8%A1%E5%BC%8F">装饰性模式</a>
            
            </li>
        
            <li><a href="./%E7%A6%BB%E7%BA%BF%E7%BC%93%E5%AD%98">离线缓存(manifest)</a>
            
            </li>
        
            <li><a href="./%E4%B8%89%E7%A7%8D%E4%B8%8D%E5%90%8C%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F">async、defer、preload区别</a>
            
            </li>
        
            <li><a href="./AngularJS%E5%AE%9E%E6%88%98-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5">AngularJS应用－基础概念</a>
            
            </li>
        
            <li><a href="./AngularJS-%E6%8C%87%E4%BB%A4">AngularJS应用－指令</a>
            
            </li>
        
            <li><a href="./Javascript%E6%A8%A1%E5%BC%8F%E5%AD%A6%E4%B9%A0-%E5%87%BD%E6%95%B0">学习笔记－设计模式 －函数</a>
            
            </li>
        
            <li><a href="./Javascript%E6%A8%A1%E5%BC%8F%E5%AD%A6%E4%B9%A0">学习笔记－设计模式－基础</a>
            
            </li>
        
            <li><a href="./%E5%AD%A6%E4%B9%A0%E6%80%9D%E8%80%83">模块化学习思考</a>
            
            </li>
        
            <li><a href="./RequireJs%E4%BD%BF%E7%94%A8">RequireJs应用</a>
            
            </li>
        
            <li><a href="./apply%E5%92%8Ccall">apply和call应用</a>
            
            </li>
        
            <li><a href="./%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81">表单验证－策略模式</a>
            
            </li>
        
            <li><a href="./%E5%86%8D%E7%9C%8B%E8%BF%94%E5%9B%9E%E5%87%BD%E6%95%B0">再看返回函数</a>
            
            </li>
        
        </ul>

        <h2>工具</h2>
        <ul class="artical-list">
        
            <li><a href="./ES6-%E5%B8%B8%E7%94%A8%E8%AF%AD%E6%B3%95">ES6 常用语法</a></li>
        
            <li><a href="./webpack%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8">webpack使用方法</a></li>
        
            <li><a href="./javascript%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83">前端规范的思考</a></li>
        
            <li><a href="./jekyll%E4%BD%BF%E7%94%A8">jekyll基本使用方式</a></li>
        
        </ul>

        <h2>项目沉淀</h2>
        <ul class="artical-list">
        
            <li><a href="./%E5%91%A8%E7%BA%AA%E5%BD%95">15年08月19日－周工作记录</a></li>
        
        </ul>
    </div>
</div>

<script src="./js/post.js" type="text/javascript"></script>


    
</body>
</html>
